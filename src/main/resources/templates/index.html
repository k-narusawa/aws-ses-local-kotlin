<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>aws-ses-local</title>
    <link th:href="@{/webjars/bootstrap/5.2.3/css/bootstrap.min.css}" rel="stylesheet">
    <style>
        .mail-content {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            background: #f9f9f9;
        }

        .mail-subject, .mail-to, .mail-from, .mail-text, .mail-html, .mail-at {
            font-weight: bold;
        }

        .select-small {
            width: 100px;
            margin: 0 auto;
            text-align: center;
        }
    </style>

</head>
<body>
<div th:insert="common/header :: header_fragment"></div>
<table class="table">
    <thead>
    <tr>
        <th scope="col">currentPage</th>
        <th scope="col">totalPage</th>
        <th scope="col">totalElements</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>[[${mails.currentPage + 1}]]</td>
        <td>[[${mails.totalPage}]]</td>
        <td>[[${mails.totalElements}]]</td>
    </tr>
    </tbody>
</table>
<div class="accordion accordion-flush" id="accordionFlush">
    <div class="accordion-item">
        <th:block th:each="mail : ${mails.emails}">
            <h2 class="accordion-header" th:id="${mail.messageId}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        th:data-bs-target="'#flush-' + ${mail.messageId}" aria-expanded="false"
                        th:aria-controls="'flush-' + ${mail.messageId}">
                    [[${mail.subject}]] to: [[${mail.destination.to[0]}]]
                </button>
            </h2>
            <div th:id="'flush-' + ${mail.messageId}" class="accordion-collapse collapse"
                 th:aria-labelledby="${mail.messageId}" data-bs-parent="#accordionFlush">
                <div class="accordion-body mail-content">
                    <p class="mail-subject">Subject: [[${mail.subject}]]</p>
                    <p class="mail-to">To: [[${mail.destination.to[0]}]]</p>
                    <p class="mail-from">From: [[${mail.from}]]</p>
                    <p class="mail-text">Text:<br/>
                        <span th:utext="${mail.body.viewText}"></span>
                    </p>
                    <p class="mail-html">HTML:<br/>
                        <span th:utext="${mail.body.html}"></span>
                    </p>
                    <p class="mail-at">At: [[${mail.at}]]</p>
                </div>
            </div>
        </th:block>
    </div>
</div>
<th:block th:if="${mails.totalPage > 0}">
    <form th:action="@{''}" method="get">
        <div class="form-group">
            <select class="form-control select-small" id="pageSelect" name="page" onchange="this.form.submit()">
                <option th:each="page : ${#numbers.sequence(0, mails.totalPage - 1)}"
                        th:value="${page + 1}"
                        th:text="${page + 1}"
                        th:selected="${page == mails.currentPage}">
                </option>
            </select>
        </div>
    </form>
</th:block>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Do you want to delete all emails?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <form th:action="@{'/clear-all'}" th:method="post" data-bs-dismiss="modal">
                    <input type="hidden" name="_method"/>
                    <button type="submit" class="btn btn-danger">Mail Clear</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.min.js}"></script>
</body>
</html>